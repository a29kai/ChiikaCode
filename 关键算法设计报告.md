# ChiikaCode 关键算法设计报告

## 一、前端算法设计

### 1. 前端算法设计

在ChiikaCode插件中，前端的算法设计主要集中在以下几个方面：

#### 1.1. 项目生成与文件创建

在ChiikaCode插件的前端开发中，项目生成和文件创建是核心功能之一。这个部分的算法设计关注于如何根据后端返回的数据（通常是一个包含目录和文件结构的JSON对象），递归地创建文件夹和文件。

##### 深度优先遍历（DFS）

为了生成整个项目结构，我们通常需要递归地遍历每一个节点。在这种情况下，项目结构中可能包含文件夹和文件，我们采用深度优先遍历（DFS）方法来逐一访问每个节点。
每个节点会携带该文件或文件夹的相关信息，比如文件名、类型（文件或文件夹）、内容（对于文件来说是其内容，对于文件夹来说是其子节点）。
DFS遍历确保了文件夹结构和内容能够按正确的顺序创建。首先创建目录，接着在目录下创建文件。如果目录中还有子目录或文件，则继续递归创建。

假如有以下项目结构

```markdown
Project
│
├── folder1
│   ├── file1.js
│   └── folder2
│       └── file2.js
└── file3.js
```

- DFS遍历过程

1. 首先，遍历到 `Project` 文件夹。
2. 然后进入 `folder1` 文件夹，继续遍历。
3. 在 `folder1` 内，首先遇到 `file1.js`，创建该文件。
4. 接着进入 `folder2` 文件夹，再遍历其中的 `file2.js`。
5. 最后，回到 `Project` 文件夹，创建 `file3.js`。

- 路径创建

使用 `vscode.Uri` 创建路径，并调用 `createDirectory()` 或 `createFile()`。

```lua
              +------------------------+
              |        Project          |
              +------------------------+
                     /        \
        +-----------------+    +-----------------+
        |    folder1      |    |     file3.js    |
        +-----------------+    +-----------------+
               /     \
      +-------------+   +---------------+
      |   file1.js  |   |    folder2     |
      +-------------+   +---------------+
                           |
                      +-----------+
                      |  file2.js |
                      +-----------+
```

##### 使用`vscode.Uri`进行路径管理

为了确保每个文件和文件夹的路径都是准确无误的，我们使用了`vscode.Uri` API来处理路径的拼接和管理。
`vscode.Uri.file(path)`方法可以生成一个URI对象，用于表示文件路径，确保路径格式与文件系统兼容。
例如，在创建文件夹时，我们先生成文件夹的URI，然后通过`vscode.workspace.fs.createDirectory()`方法创建目录。如果是文件，则通过`vscode.workspace.fs.createFile()`来创建文件并写入内容。

##### 根据节点类型选择创建方法

在遍历项目结构时，我们根据每个节点的类型（文件夹或文件）来调用不同的创建方法。对于文件夹，我们只需要调用`createDirectory()`；对于文件，则需要通过`createFile()`和后续的`WorkspaceEdit`操作来创建文件并填充内容。

##### 递归创建目录和文件

当遇到一个文件夹节点时，系统会首先检查该文件夹是否已存在，如果不存在则创建它。创建文件夹后，系统会继续递归处理该文件夹中的子节点。如果节点是文件，则会创建该文件并写入内容，文件创建的路径也是递归生成的。

#### 1.2. 消息处理机制

前端通过`onDidReceiveMessage`和`window.addEventListener('message')`监听来自后端的消息，并通过解析不同的消息命令来选择合适的处理逻辑。算法设计中需要考虑消息的高效分发与处理，保证用户交互的流畅性。

#### 1.3. UI更新与数据绑定

在处理完后端请求并收到响应后，前端需要通过事件驱动机制更新UI。我们使用了原生的JavaScript事件机制，并结合前端框架（如HTML的DOM事件），来确保UI在收到数据后及时渲染。例如，生成的代码会通过`responseContainer`动态展示，用户交互后会即时反映到UI上。
